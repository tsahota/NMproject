<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Script Based Interface To NONMEM • NMproject</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Script Based Interface To NONMEM">
<meta property="og:description" content="Script based model development in NONMEM.">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">NMproject</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="nmproject" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#nmproject" class="anchor"></a>NMproject</h1></div>

<p>This is the newer beta interface. To use the older interface, install v0.3.2 (see releases)</p>
<p>Script based NONMEM execution on tidyprojects with shiny interface.</p>
<ul>
<li>Tidy code:
<ul>
<li>Standardised, version controlled, directory structure for all NONMEM users.</li>
<li>Enforcement of basic NONMEM control stream coding conventions around parameter naming for human and machine readability</li>
</ul>
</li>
<li>PMX Code library:
<ul>
<li>Keep NONMEM template scripts to speed creation of NONMEM runs and facilitate adherence to best practices.</li>
<li>“Attach” community-wide, organisation-wide, or individual code repositories.</li>
</ul>
</li>
<li>Script based model development:
<ul>
<li>Code your model development process using end-to-end R workflows.</li>
<li>Private project R libraries for long term reproducibility and consistent running of R scripts between users.</li>
</ul>
</li>
<li>Shiny interface:
<ul>
<li>Table of runs</li>
<li>Real time run tracking</li>
<li>Run comparison</li>
</ul>
</li>
</ul>
<p>Two-minute Youtube summary (alpha interface): <a href="https://www.youtube.com/watch?v=b7oBb6QZub8" class="uri">https://www.youtube.com/watch?v=b7oBb6QZub8</a></p>
<p><img src="https://user-images.githubusercontent.com/18026277/26879195-79b6f4c0-4b90-11e7-8228-01b117e64a12.png" width="24.6%"><img src="https://user-images.githubusercontent.com/18026277/26879231-a046cfc0-4b90-11e7-9dbf-666086f32b9d.png" width="24.5%"><img src="https://user-images.githubusercontent.com/18026277/26879238-a4a94fc0-4b90-11e7-8e8f-1b12a03f912d.png" width="24.5%"><img src="https://user-images.githubusercontent.com/18026277/26879240-a7a53ebe-4b90-11e7-80fa-74bef643db29.png" width="24.5%"></p>
<p>History: NMproject was previously an AstraZeneca project. It is being reimplemented here as a community version to be compatible with a variety of architectures (standalone NONMEM and a variety of grid submission systems)</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>NONMEM, PsN, and Rstudio are required to be installed prior to these steps. To install a specific release version (e.g. v0.5.1)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/">"devtools"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"tsahota/NMproject@v0.5.1"</span><span class="op">)</span></code></pre></div>
<p>To install the latest developmental version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"tsahota/NMproject"</span><span class="op">)</span></code></pre></div>
<p>Load the package with</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">NMproject</span><span class="op">)</span></code></pre></div>
</div>
<div id="instructions" class="section level2">
<h2 class="hasAnchor">
<a href="#instructions" class="anchor"></a>Instructions</h2>
<ul>
<li>NMprojects are directories where you can work on pharmacometric analysis.</li>
<li>First, set up a tidyproject with the <code>make_project("/path/to/project/dir"")</code> or in RStudio File -&gt; New Project -&gt; New Directory -&gt; New tidyproject
<ul>
<li>See tutorial at <a href="https://github.com/tsahota/tidyproject" class="uri">https://github.com/tsahota/tidyproject</a> for more information</li>
</ul>
</li>
</ul>
<div id="demo" class="section level3">
<h3 class="hasAnchor">
<a href="#demo" class="anchor"></a>Demo</h3>
<p>The easiest way to familiarise your with NMproject is to follow through the demo.</p>
<p>To step through the theophylline example, create a new tidyproject and run the following</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">NMproject</span><span class="op">)</span>
<span class="fu"><a href="reference/setup_nm_demo.html">setup_nm_demo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>open the <code>Scripts</code> directory and step through the scripts s01…..Rmd, s02….Rmd to familiarise yourself with the functions</p>
</div>
<div id="basic-commands" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-commands" class="anchor"></a>Basic commands</h3>
<p>To get started with your own analysis, copy your dataset to <code>SourceData</code> directory.</p>
<p>Then open a generic Rmardown template (New Rmarkdown -&gt; From Template -&gt; NMproject generic), write a script to read in your SourceData and save a processed NONMEM version of this in <code>DerivedData</code>.</p>
<p>Then open a model development Rmarkdown template. First step is to find a NONMEM template control stream in the code library. View it with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">code_library</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Preview code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">preview</span><span class="op">(</span><span class="st">"Models/ADVAN2.mod"</span><span class="op">)</span></code></pre></div>
<p>import file into project</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ls_code_library</span><span class="op">(</span><span class="st">"Models/ADVAN2.mod"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stage</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The model will be in the staging area: <code>staging/Models/ADVAN2.mod</code></p>
<p>The following command will create an object of class <code>nm</code> with information about the run. This will not run the command yet.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nm.html">nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
         based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
         data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span>,
         cmd <span class="op">=</span> <span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span></code></pre></div>
<p>Edit the control file manually by highlighting the entire command and starting a manual edit (addins -&gt; manual edit). Follow the instructions to edit the file to be fit for purpose. This will the <code>apply_manual_edit</code> command to your code like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nm.html">nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
         based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
         data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span>,
         cmd <span class="op">=</span> <span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="reference/apply_manual_edit.html">apply_manual_edit</a></span><span class="op">(</span><span class="st">"patch-tsdk2324-2021-01-01-02-42-28"</span><span class="op">)</span>
      </code></pre></div>
<p>Add a <code>run_nm</code> command to make it run (at this point the control will be created on disk in the <code><a href="reference/nm_getsetters.html">run_in(m)</a></code> location.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nm.html">nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
         based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
         data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span>,
         cmd <span class="op">=</span> <span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="reference/apply_manual_edit.html">apply_manual_edit</a></span><span class="op">(</span><span class="st">"patch-tsdk2324-2021-01-01-02-42-28"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span>
      </code></pre></div>
<p>Test out your run by running nm_tran add_in or typing the following into the console</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nm_tran.html">nm_tran</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span> </code></pre></div>
<p>Send this command to the console to get it running.</p>
<p>To view all runs in the workspace and track progress:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/shiny_nm.html">shiny_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To do basic goodness of fit open the post processing Rmarkdown template, follow instructions, customise your template save it (e.g. as <code>Scripts/basic_gof.Rmd</code>) and run in your log script with</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/nm_render.html">nm_render</a></span><span class="op">(</span><span class="st">"Scripts/basic_gof.Rmd"</span><span class="op">)</span></code></pre></div>
<p>It will create the output in <code>Results</code> (or results_dir(m1))</p>
<p>To create additional runs (child runs) use the child function and modify, e.g. to convert from <code>advan2 trans1</code> to <code>advan2 trans2</code> do the following</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m2"</span><span class="op">)</span> <span class="op">%&gt;%</span>
             <span class="fu"><a href="reference/subroutine.html">subroutine</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
             <span class="fu"><a href="reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To add a covariate:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m3</span> <span class="op">&lt;-</span> <span class="va">m2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m3"</span><span class="op">)</span> <span class="op">%&gt;%</span>
             <span class="fu"><a href="reference/add_cov.html">add_cov</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"CL"</span>, cov <span class="op">=</span> <span class="st">"WT"</span>, state <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op">%&gt;%</span>
             <span class="fu"><a href="reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Evaluate and compare runs on the fly with the following commands</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/rr.html">rr</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="fu"><a href="reference/rr.html">rr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m2</span>, <span class="va">m3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="reference/plot_iter.html">plot_iter</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>
<span class="fu"><a href="reference/covariance_plot.html">covariance_plot</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></code></pre></div>
<p>To create a simulation:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2s</span> <span class="op">&lt;-</span> <span class="va">m2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m2s"</span><span class="op">)</span> <span class="op">%&gt;%</span>
              <span class="fu">update_parameter</span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="reference/convert_to_simulation.html">convert_to_simulation</a></span><span class="op">(</span>subpr <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>For simulation runs, use the VPC and PPC templates together with <code>nm_render</code> like the basic goodness of template used above.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2s</span> <span class="op">&lt;-</span> <span class="va">m2s</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/nm_render.html">nm_render</a></span><span class="op">(</span><span class="st">"Scripts/basic_vpc.Rmd"</span><span class="op">)</span>
<span class="va">m2s</span> <span class="op">&lt;-</span> <span class="va">m2s</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/nm_render.html">nm_render</a></span><span class="op">(</span><span class="st">"Scripts/basic_ppc.Rmd"</span><span class="op">)</span></code></pre></div>
<p>Don’t forget to comment your code with your decision making.</p>
</div>
</div>
<div id="faq" class="section level2">
<h2 class="hasAnchor">
<a href="#faq" class="anchor"></a>FAQ</h2>
<div id="-after-having-closed-my-session-how-to-i-recreate-my-workspace" class="section level3">
<h3 class="hasAnchor">
<a href="#-after-having-closed-my-session-how-to-i-recreate-my-workspace" class="anchor"></a>+ After having closed my session how to I recreate my workspace</h3>
<p>Just re-run all the code again.</p>
<p>If nothing has changed with regards to datasets and control files run_nm() will retrieve cached results without running nonmem.</p>
</div>
<div id="-i-see-the-pmx-code-library-has-been-updated-how-can-i-update-my-local-version-of-it" class="section level3">
<h3 class="hasAnchor">
<a href="#-i-see-the-pmx-code-library-has-been-updated-how-can-i-update-my-local-version-of-it" class="anchor"></a>+ I see the PMX code library has been updated, how can I update my local version of it?</h3>
<p>The PMX code library is version controlled with <code>git</code>. Ensure you have git installed, navigate to the local PMX code library repository and type <code>git pull</code>. Git will complain if you have made changes to your local directory since downloading it. If you have, you need to <code>commit</code> those changes before using <code>git pull</code>. See git help for more information on how to do this. Consider splitting your code library into multiple repositories for easier management (e.g. one public, one for your organisation, one for you)</p>
</div>
<div id="-we-already-have-directory-of-rnonmem-scriptstemplates-how-can-we-also-use-these" class="section level3">
<h3 class="hasAnchor">
<a href="#-we-already-have-directory-of-rnonmem-scriptstemplates-how-can-we-also-use-these" class="anchor"></a>+ We already have directory of R/NONMEM scripts/templates, how can we also use these?</h3>
<p>Append your directory location to the <code>code_library_path</code> option. To do this add the following command to your <code>~/.Rprofile</code> (or <code>$R_HOME/etc/Rprofile.site</code>) configuration file:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>code_library_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"/path/to/PMXcodelibrary/"</span>,<span class="st">"path/to/existing/repository"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="-how-can-i-contribute-to-the-pmx-code-library" class="section level3">
<h3 class="hasAnchor">
<a href="#-how-can-i-contribute-to-the-pmx-code-library" class="anchor"></a>+ How can I contribute to the PMX code library?</h3>
<p>Log in to github (create an account if necessary). Fork the repository <code>tsahota/PMXcodelibrary</code>. Make your change. Create a pull request detailing your change.</p>
</div>
<div id="-how-do-i-run-this-on-sge" class="section level3">
<h3 class="hasAnchor">
<a href="#-how-do-i-run-this-on-sge" class="anchor"></a>+ How do I run this on SGE?</h3>
<p>There is a pre-prepared built in <code>sge_parallel_execute</code> character object that’s part of NMproject. This uses the grid functionality built into PsN and has been tested to work within the Metworx platform. Simply type it in the console to see the contents. Required fields are <code>parafile</code>, <code>cores</code>. Ensure these are set for your parent object like so.</p>
<pre class="{r}"><code>m1 &lt;- m1 %&gt;% 
  cmd(sge_parallel_execute) %&gt;%
  parafile("/opt/NONMEM/nm750/run/mpilinux8.pnm") %&gt;%
  cores(8)</code></pre>
<p>Note that child object will inherit the same <code>cmd</code> structure</p>
</div>
<div id="-how-do-i-run-this-on-other-clusters-like-slurm-lsf-torque" class="section level3">
<h3 class="hasAnchor">
<a href="#-how-do-i-run-this-on-other-clusters-like-slurm-lsf-torque" class="anchor"></a>+ How do I run this on other clusters like Slurm, LSF, Torque</h3>
<p>The workflow is similar to above where PsN handles the grid submission. You will need to create your own analog character to <code>sge_parallel_execute</code> for your respective cluster. It is recommended to consult PsN documentation to “gridify” your PsN command. Once you have this, it’s just a simple matter of replacing your control file name, run directory, parafile and desired number of cores with the relevant glue field (e.g. <code>{parafile}</code>) and then putting it into your parent <code><a href="reference/nm_getsetters.html">cmd()</a></code> command to get it running through NMproject.</p>
<p>Feel free to contact me if you need help</p>
</div>
<div id="-how-do-i-run-nonmem-via-a-psnnonmem-docker-container" class="section level3">
<h3 class="hasAnchor">
<a href="#-how-do-i-run-nonmem-via-a-psnnonmem-docker-container" class="anchor"></a>+ How do I run NONMEM via a PsN/NONMEM docker container</h3>
<p>This requires setting <code><a href="reference/nm_getsetters.html">cmd()</a></code> field of the first (parent) nm object and also setting <code><a href="reference/nm_tran_command.html">nm_tran_command()</a></code> once in your script.</p>
<p>Easiest way to understand this is via an example: The following assumes the docker container has been set as shown in the fabulous <code>https://github.com/billdenney/Pharmacometrics-Docker</code> repository:</p>
<p>Set cmd for an <code>execute</code> command like so:</p>
<pre class="{r}"><code>m1 %&gt;% 
  cmd("docker run --rm --user=$(id -u):$(id -g) -v $(pwd):/data -w /data humanpredictions/psn execute {ctl_name} -dir={run_dir}")</code></pre>
<p><code><a href="reference/run_nm.html">run_nm()</a></code> will then execute NONMEM via the docker container. All subsequent child objects will inherit the same command structure. Note the use the glueing object fields <code>ctl_name</code> and <code>run_dir</code> so child objects can inherit the same command structure to save the command being rewritten for each run)</p>
<p>Set up dockerized NMTRAN checking with:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nm_tran_command.html">nm_tran_command</a></span><span class="op">(</span><span class="st">"docker run --rm --user=$(id -u):$(id -g) -v $(pwd):/data -w /data humanpredictions/psn /bin/bash -c '/opt/NONMEM/nm_current/tr/NMTRAN.exe &lt; {ctl_name}'"</span><span class="op">)</span></code></pre></div>
</div>
<div id="-my-rstudio-server-is-on-a-different-linux-server-to-my-nonmem-cluster-how-can-i-set-up-nmproject-to-work-with-this" class="section level3">
<h3 class="hasAnchor">
<a href="#-my-rstudio-server-is-on-a-different-linux-server-to-my-nonmem-cluster-how-can-i-set-up-nmproject-to-work-with-this" class="anchor"></a>+ My Rstudio Server is on a different linux server to my NONMEM cluster. How can I set up NMproject to work with this?</h3>
<p>You need to ensure your account has passwordless ssh set up. Then create a <code><a href="reference/system_nm.html">system_nm()</a></code> option in your <code>~/.Rprofile</code> configuration file which appends an ssh statement to the system call e.g. the following will set you up to connect to the host <code>clustername</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>system_nm<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">cmd</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"ssh -q clustername \"cd $(pwd); "</span>,<span class="va">cmd</span>,<span class="st">"\""</span><span class="op">)</span>,<span class="va">...</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="-im-working-on-a-windows-laptop-but-want-to-use-my-nonmem-cluster-for-nonmem-jobs-how-can-i-set-up-nmproject-to-work-with-this" class="section level3">
<h3 class="hasAnchor">
<a href="#-im-working-on-a-windows-laptop-but-want-to-use-my-nonmem-cluster-for-nonmem-jobs-how-can-i-set-up-nmproject-to-work-with-this" class="anchor"></a>+ I’m working on a windows laptop but want to use my NONMEM cluster for NONMEM jobs. How can I set up NMproject to work with this?</h3>
<p>This is not recommended as it requires R working directory being set to a networked drive. This is very slow. If you really want to though consider modifying the <code><a href="reference/system_nm.html">system_nm()</a></code> option, as in the above FAQ question, to use <code>plink</code> to ssh to the server, change to the relevant working directory and submit a command. This has not been tested however and results are likely to be disappointing.</p>
</div>
<div id="-my-organisation-has-a-different-control-file-convention-to-the-runxxmod-convention-can-i-change-this" class="section level3">
<h3 class="hasAnchor">
<a href="#-my-organisation-has-a-different-control-file-convention-to-the-runxxmod-convention-can-i-change-this" class="anchor"></a>+ My organisation has a different control file convention to the runXX.mod convention. Can I change this?</h3>
<p>Yes, you can specify the convention with the ctl_path() e.g. to change the convention to nm.XX.con</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/ctl_path.html">ctl_path</a></span><span class="op">(</span><span class="st">"Models/nm.{run_id}.com"</span><span class="op">)</span></code></pre></div>
<p>Consider making a wrapper function around nm() and ctl_path() and distributing to your users</p>
</div>
<div id="-how-do-i-submit-a-command-directly-to-the-nonmem-server" class="section level3">
<h3 class="hasAnchor">
<a href="#-how-do-i-submit-a-command-directly-to-the-nonmem-server" class="anchor"></a>+ How do I submit a command directly to the NONMEM server?</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/system_nm.html">system_nm</a></span><span class="op">(</span><span class="st">"command_to_run"</span>,dir<span class="op">=</span><span class="st">"path/to/dir"</span><span class="op">)</span></code></pre></div>
</div>
<div id="-there-is-functionality-in-psns-runrecord-sumo-or-pirana-that-i-would-like-but-is-not-currently-available-in-nmproject" class="section level3">
<h3 class="hasAnchor">
<a href="#-there-is-functionality-in-psns-runrecord-sumo-or-pirana-that-i-would-like-but-is-not-currently-available-in-nmproject" class="anchor"></a>+ There is functionality in PsN’s runrecord, sumo or Pirana that I would like but is not currently available in NMproject.</h3>
<p>NMproject doesn’t change PsN’s default directory structure, everything in the “Models” directory is as if you lauched the jobs from the command line. Therefore you can continue to use PsN functions on the command line. You can also continue using Pirana by pointing it towards your models directory.</p>
<p>If it’s something you think really should be part of NMproject, open a github “issue” and ask for the feature.</p>
</div>
<div id="-i-dont-want-to-use-nmproject-on-my-analysis-project-any-more-can-i-go-back-to-submitting-runs-on-the-command-line" class="section level3">
<h3 class="hasAnchor">
<a href="#-i-dont-want-to-use-nmproject-on-my-analysis-project-any-more-can-i-go-back-to-submitting-runs-on-the-command-line" class="anchor"></a>+ I don’t want to use NMproject on my analysis project any more, can I go back to submitting runs on the command line</h3>
<p>Yes, NMproject doesn’t change PsN’s default directory structure, so you can go back to running PsN via command line. If there a bug or a feature you think really should be part of NMproject, consider opening a github “issue” and asking.</p>
</div>
<div id="-i-work-for-a-cro-my-client-doesnt-have-nmproject-how-can-send-the-analysis-to-them" class="section level3">
<h3 class="hasAnchor">
<a href="#-i-work-for-a-cro-my-client-doesnt-have-nmproject-how-can-send-the-analysis-to-them" class="anchor"></a>+ I work for a CRO. My client doesn’t have NMproject, how can send the analysis to them.</h3>
<p>NMproject doesn’t change PsN’s default directory structure, and everything will work for them as long as their version of R (and package versions) are compatible. It is recommended to run Renvironment_info() as a last step before sending the analysis directory so they can see the package versions you used.</p>
<p>Obviously they will not be able to run code that is dependent on NMproject unless they install it. But your model development script can still serve as a helpful, human readable process description of your model development steps.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Tarj Sahota <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/tsahota/NMproject"><img src="https://travis-ci.org/tsahota/NMproject.svg?branch=develop" alt="Travis-CI Build Status"></a></li>
<li><a href="https://coveralls.io/github/tsahota/NMproject?branch=newinterface"><img src="https://coveralls.io/repos/github/tsahota/NMproject/badge.svg?branch=develop" alt="Coverage Status"></a></li>
<li><a href="https://ci.appveyor.com/project/tsahota/NMproject"><img src="https://ci.appveyor.com/api/projects/status/github/tsahota/NMproject?branch=develop&amp;svg=true" alt="AppVeyor Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
