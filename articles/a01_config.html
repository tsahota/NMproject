<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configuration &amp; Setup Options • NMproject</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Configuration &amp; Setup Options">
<meta property="og:description" content="NMproject">
<meta property="og:image" content="https://tsahota.github.io/NMproject/logo.svg">
<meta name="google-site-verification" content="Asq9eKyn87Krpkza8Y-Y_XiS5V6eNXGAreGhOYcBKd0">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMproject</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_config.html">Configuration &amp; Setup Options</a>
    </li>
    <li>
      <a href="../articles/a02_analysis_directories.html">Analysis Directories</a>
    </li>
    <li>
      <a href="../articles/a03_demo.html">The Demo</a>
    </li>
    <li>
      <a href="../articles/a04_code_library.html">Code Library</a>
    </li>
    <li>
      <a href="../articles/a05_core_object.html">The basics of the NM object</a>
    </li>
    <li>
      <a href="../articles/a06_execution.html">NONMEM execution</a>
    </li>
    <li>
      <a href="../articles/a07_post_processing.html">Post-processing &amp; diagnostics</a>
    </li>
    <li>
      <a href="../articles/a08_covariate_modelling.html">Covariate Modelling</a>
    </li>
    <li>
      <a href="../articles/a09_advanced_topics.html">Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/a10_FAQ.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tsahota/NMproject/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a01_config_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Configuration &amp; Setup Options</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tsahota/NMproject/blob/HEAD/vignettes/articles/a01_config.Rmd" class="external-link"><code>vignettes/articles/a01_config.Rmd</code></a></small>
      <div class="hidden name"><code>a01_config.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>The following need to be installed and available:</p>
<ul>
<li>PsN &gt;= 4.4.8</li>
<li>NONMEM installed with valid license</li>
<li>RStudio</li>
</ul>
</div>
<div class="section level2">
<h2 id="first-time-set-up">First time set up<a class="anchor" aria-label="anchor" href="#first-time-set-up"></a>
</h2>
<div class="section level3">
<h3 id="set-up-code-completion">Set up code completion<a class="anchor" aria-label="anchor" href="#set-up-code-completion"></a>
</h3>
<p>It is highly recommended to set up code completion though as it eases the scripting process.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setup_code_completion.html">setup_code_completion</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This will ask for user consent as it will add entries to the user level snippets file.</p>
</div>
<div class="section level3">
<h3 id="verify-installation">Verify installation<a class="anchor" aria-label="anchor" href="#verify-installation"></a>
</h3>
<p>The following function checks for availability of PsN via <code><a href="../reference/system_nm.html">system_nm()</a></code>, this is a requirement for NMproject. There are also subsequent checks which not mandatory, but recommended for full functionality.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/check_installation.html">check_installation</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> 🎉</span></code></pre>
<p>Users working on a standalone machines (e.g. laptops and desktops) should expect these tests to pass and for NMproject to work out of the box (provided the pre-requisites are met).</p>
</div>
</div>
<div class="section level2">
<h2 id="custom-configuration">Custom configuration<a class="anchor" aria-label="anchor" href="#custom-configuration"></a>
</h2>
<p>More complex environments involving multiple servers and grids may require more configuration. The options shown here aim to facilitate that. You may need the help of an admin.</p>
<div class="section level3">
<h3 id="nmtran-checks">NMTRAN checks<a class="anchor" aria-label="anchor" href="#nmtran-checks"></a>
</h3>
<p>If working in a grid environment, it is highly recommended to perform NMTRAN checks prior to sending jobs off the grid. NMTRAN check provides immediate feedback of control file and dataset errors allowing you to address problems quickly just like if you were on a laptop/desktop environment. Without this, having to wait for a job to reach the grid and fail is a much slower (and more annoying) process.</p>
<p>NMproject tries to guess the location to the NMTRAN file in the NONMEM installation directory however if this fails and <code><a href="../reference/check_installation.html">check_installation()</a></code> cannot detect it, you will need to specify the NMTRAN command/file with the <code><a href="../reference/nm_tran_command.html">nm_tran_command()</a></code> function. See the following for instructions and examples at the bottom of the help file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/nm_tran_command.html">nm_tran_command</a></span><span class="op">(</span><span class="st">"/opt/NONMEM/nm75/tr/NMTRAN.exe"</span><span class="op">)</span></code></pre></div>
<p>To see more examples see <code><a href="../reference/nm_tran_command.html">?nm_tran_command</a></code>.</p>
<p>This setting will reset upon R session restart, if you want to make it permanent see <a href="#permanent">Making configuration changes permanent</a>.</p>
</div>
<div class="section level3">
<h3 id="the-system_nm-command">The <code>system_nm()</code> command<a class="anchor" aria-label="anchor" href="#the-system_nm-command"></a>
</h3>
<p>Under the hood, all calls to PsN proceed through the <code><a href="../reference/system_nm.html">system_nm()</a></code> command. This is a user configurable function. By default it’s the same as <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code> on unix systems and <code><a href="https://rdrr.io/r/base/system.html" class="external-link">shell()</a></code> on windows. However if the NONMEM server is remote and requires connection (e.g. via SSH), users may want to modify the behaviour of <code><a href="../reference/system_nm.html">system_nm()</a></code>. This is possible through setting the <code><a href="https://rdrr.io/r/base/options.html" class="external-link">option()</a></code> also named <code>system_nm</code>, e.g. the following allows runs the <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code> command on a remote machine named <code>clustername</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>system_nm<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">cmd</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ssh -q clustername \"cd $(pwd); "</span>, <span class="va">cmd</span>, <span class="st">"\""</span><span class="op">)</span>,<span class="va">...</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>This setting will reset upon R session restart, if you want to make it permanent see <a href="#permanent">Making configuration changes permanent</a>.</p>
</div>
<div class="section level3">
<h3 id="custom-code-library-location">Custom code library location<a class="anchor" aria-label="anchor" href="#custom-code-library-location"></a>
</h3>
<p>NMproject ships with a code library that can be used without configuration. If however you want to have a custom code library, the option <code>code_library_path</code> can be used to set this. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>code_library_path <span class="op">=</span> <span class="st">"/projects/myorganisation/code_library"</span><span class="op">)</span></code></pre></div>
<p>To see more information see <code><a href="../reference/code_library.html">?code_library</a></code>.</p>
<p>This setting will reset upon R session restart, if you want to make it permanent see <a href="#permanent">Making configuration changes permanent</a>.</p>
</div>
<div class="section level3">
<h3 id="custom-directory-structures">Custom directory structures<a class="anchor" aria-label="anchor" href="#custom-directory-structures"></a>
</h3>
<p>If your organisation prefers a project directory sub-structure which is different from the standard this can be configured with the function <code><a href="../reference/nm_default_dirs.html">nm_default_dirs()</a></code>. For example if your organisation performs NONMEM modelling in a directory called “NONMEM” and has a set structure for other sub-directories, you may have something like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/nm_default_dirs.html">nm_default_dirs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  models <span class="op">=</span> <span class="st">"NONMEM"</span>,
  scripts <span class="op">=</span> <span class="st">"RSCRIPTS"</span>,
  results <span class="op">=</span> <span class="st">"OUTPUTS"</span>,
  source_data <span class="op">=</span> <span class="st">"DATA/SOURCE"</span>,
  derived_data <span class="op">=</span> <span class="st">"DATA/DERIVED"</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To see more examples see <code><a href="../reference/nm_default_dirs.html">?nm_default_dirs</a></code>.</p>
<p>This setting will reset upon R session restart, if you want to make it permanent see <a href="#permanent">Making configuration changes permanent</a>.</p>
</div>
<div class="section level3">
<h3 id="custom-object-properties">Custom object properties<a class="anchor" aria-label="anchor" href="#custom-object-properties"></a>
</h3>
<p>If you have a custom PsN command you tend to submit for all NONMEM jobs, use the <code>nm_default_fields</code> function. For example to set a default parafile and modify the basic <code>"execute {ctl_name} -dir={run_dir}"</code> command to use this parafile, you would use the command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">nm_default_fields</span>(<span class="kw">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">parafile =</span> <span class="st">"/opt/NONMEM/nm75/run/mpilinux8.pnm"</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="dt">cmd =</span> <span class="st">"execute -parafile={parafile} {ctl_name} -dir={run_dir} -nodes={cores}"</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>))</span></code></pre></div>
<p>To see more examples see <code><a href="../reference/nm_default_fields.html">?nm_default_fields</a></code>.</p>
<p>This setting will reset upon R session restart, if you want to make it permanent see <a href="#permanent">Making configuration changes permanent</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="permanent">Making configuration changes permanent<a class="anchor" aria-label="anchor" href="#permanent"></a>
</h2>
<div class="section level3">
<h3 id="via-startup-scripts">Via startup scripts<a class="anchor" aria-label="anchor" href="#via-startup-scripts"></a>
</h3>
<p>Whether it be a custom NMTRAN path, <code>system_nm</code> option or a different default directory structure, to make the above changes permanent, they need to be executed every R session.</p>
<p>R has a few mechanisms for achieving this. See <code><a href="https://rdrr.io/r/base/Startup.html" class="external-link">?.Rprofile</a></code> for details. The following will open your config file:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_profile</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Then insert the configuration code into this file and restart R. For example a custom NMTRAN path can be set permanently to <code>"/opt/NONMEM/nm75/tr/NMTRAN.exe"</code> by including <code>nm_tran_command("/opt/NONMEM/nm75/tr/NMTRAN.exe")</code> into the file.</p>
<p>To set the option site wide you can use the file <code>$R_HOME/etc/Rprofile.site</code> (requires administration privileges).</p>
</div>
<div class="section level3">
<h3 id="via-a-custom-package">Via a custom package<a class="anchor" aria-label="anchor" href="#via-a-custom-package"></a>
</h3>
<p>If you already have a package you maintain to deliver functions to users, this package can be used to configure set up options via the <code>.onLoad</code> hook. For example, the following will configure custom NMTRAN and code library settings on package load</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">.onLoad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">libname</span>, <span class="va">pkgname</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## custom NMTRAN location  </span>
  <span class="fu">NMproject</span><span class="fu">::</span><span class="fu"><a href="../reference/nm_tran_command.html">nm_tran_command</a></span><span class="op">(</span><span class="st">"/opt/NONMEM/nm75/tr/NMTRAN.exe"</span><span class="op">)</span>
  <span class="co">## custom code library location</span>
  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>code_library_path <span class="op">=</span> <span class="st">"/projects/myorganisation/code_library"</span><span class="op">)</span>
  <span class="co">## message to users in interactive sessions</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/ui.html" class="external-link">ui_done</a></span><span class="op">(</span><span class="st">"NMproject configured"</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<p>The advantage of a package is you can also bundle other functions in there for users to use.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'be93a35b426aba9fa8e576efbb2011e7',
    indexName: 'NMproject',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
