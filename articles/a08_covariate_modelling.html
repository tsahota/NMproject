<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Covariate Modelling • NMproject</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Covariate Modelling">
<meta property="og:description" content="NMproject">
<meta property="og:image" content="https://tsahota.github.io/NMproject/logo.svg">
<meta name="google-site-verification" content="Asq9eKyn87Krpkza8Y-Y_XiS5V6eNXGAreGhOYcBKd0">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMproject</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_config.html">Configuration &amp; Setup Options</a>
    </li>
    <li>
      <a href="../articles/a02_analysis_directories.html">Analysis Directories</a>
    </li>
    <li>
      <a href="../articles/a03_demo.html">The Demo</a>
    </li>
    <li>
      <a href="../articles/a04_code_library.html">Code Library</a>
    </li>
    <li>
      <a href="../articles/a05_core_object.html">The basics of the NM object</a>
    </li>
    <li>
      <a href="../articles/a06_execution.html">NONMEM execution</a>
    </li>
    <li>
      <a href="../articles/a07_post_processing.html">Post-processing &amp; diagnostics</a>
    </li>
    <li>
      <a href="../articles/a08_covariate_modelling.html">Covariate Modelling</a>
    </li>
    <li>
      <a href="../articles/a09_advanced_topics.html">Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/a10_FAQ.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tsahota/NMproject/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a08_covariate_modelling_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Covariate Modelling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tsahota/NMproject/blob/HEAD/vignettes/articles/a08_covariate_modelling.Rmd" class="external-link"><code>vignettes/articles/a08_covariate_modelling.Rmd</code></a></small>
      <div class="hidden name"><code>a08_covariate_modelling.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="stepwise-covariate-selection">Stepwise covariate selection<a class="anchor" aria-label="anchor" href="#stepwise-covariate-selection"></a>
</h2>
<p>The goal of NMproject’s covariate modelling functions is to provide a stepwise covariate method <em>with manual decision</em> making. This important to ensure that the full model selection/evaluation criteria (should be defined in statistical analysis plans) can be applied at every step rather than just log likelihood ratio testing, where the most significant model may be unstable, may worsen model predictions or may only be slightly more significant than a more physiologically plausible covariate relationship.</p>
<p>The functions <code><a href="../reference/test_relations.html">test_relations()</a></code>, <code><a href="../reference/covariate_step_tibble.html">covariate_step_tibble()</a></code>, <code><a href="../reference/bind_covariate_results.html">bind_covariate_results()</a></code> together comprise NMproject stepwise covariate method with manual decision. The goal is to be part way between PsN’s SCM and completely manual process at each forward and backward elimination step. The syntax of how covariates are included is the same as PsN’s SCM routine - See <a href="https://uupharmacometrics.github.io/PsN/docs.html" class="external-link">PsN documentation</a> for more information.</p>
<p>Relationships to tests are defined using the <code><a href="../reference/test_relations.html">test_relations()</a></code> function. Below we test <code>BWT</code> and <code>AGE</code> on all parameters in both <code>linear</code> and <code>power</code> fashion and all parameters are test with the categorical covariate <code>SEX</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/test_relations.html">test_relations</a></span><span class="op">(</span>param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KA"</span>, <span class="st">"K"</span>, <span class="st">"V"</span><span class="op">)</span>,</span>
<span>                        cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BWT"</span>, <span class="st">"AGE"</span><span class="op">)</span>,</span>
<span>                        state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"linear"</span>, <span class="st">"power"</span><span class="op">)</span>,</span>
<span>                        continuous <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dtest</span> <span class="op">&lt;-</span> <span class="va">dtest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/test_relations.html">test_relations</a></span><span class="op">(</span>param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KA"</span>, <span class="st">"K"</span>, <span class="st">"V"</span><span class="op">)</span>,</span>
<span>                                  cov <span class="op">=</span> <span class="st">"SEX"</span>,</span>
<span>                                  state <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>                                  continuous <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtest</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 4</span></span></span>
<span><span class="co">#&gt;    param cov   state  continuous</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> KA    BWT   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> K     BWT   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> V     BWT   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> KA    AGE   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> K     AGE   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> V     AGE   linear TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> KA    BWT   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> K     BWT   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> V     BWT   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> KA    AGE   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> K     AGE   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> V     AGE   power  TRUE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> KA    SEX   linear FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> K     SEX   linear FALSE     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> V     SEX   linear FALSE</span></span></code></pre></div>
<p>The workflow for forward (and backward) steps then becomes</p>
<ol style="list-style-type: decimal">
<li>create a <code>tibble</code> of runs for the next step with <code><a href="../reference/covariate_step_tibble.html">covariate_step_tibble()</a></code>
</li>
<li>run all with <code><a href="../reference/run_nm.html">run_nm()</a></code>
</li>
<li>collect results with <code><a href="../reference/bind_covariate_results.html">bind_covariate_results()</a></code>
</li>
<li>evaluate top performing runs</li>
<li>Either select a run to take to the next step (go back to step 1) OR stop.</li>
</ol>
<p>Here are steps 1-3 in action:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## create tibble of covariate step with model objects as column m</span></span>
<span><span class="va">dsm1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/covariate_step_tibble.html">covariate_step_tibble</a></span><span class="op">(</span></span>
<span>  run_id <span class="op">=</span> <span class="st">"m1_f1"</span>,</span>
<span>  dtest <span class="op">=</span> <span class="va">dtest</span>,</span>
<span>  direction <span class="op">=</span> <span class="st">"forward"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## run all models greedily and wait for them to finish</span></span>
<span><span class="va">dsm1</span><span class="op">$</span><span class="va">m</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/wait_finish.html">wait_finish</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## extract results and put into tibble</span></span>
<span><span class="va">dsm1</span> <span class="op">&lt;-</span> <span class="va">dsm1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/bind_covariate_results.html">bind_covariate_results</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here are steps 4-5: evaluate and select</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## sort by BIC (for example) and view</span></span>
<span><span class="va">dsm1</span> <span class="op">&lt;-</span> <span class="va">dsm1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="va">BIC</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## check condition number, covariance,...</span></span>
<span></span>
<span><span class="co">## run diagnostic reports on the top three</span></span>
<span><span class="va">dsm1</span><span class="op">$</span><span class="va">m</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/nm_render.html">nm_render</a></span><span class="op">(</span><span class="st">"Scripts/basic_gof.Rmd"</span><span class="op">)</span></span>
<span><span class="co">## diagnostic reports will not be in "Results" like other runs</span></span>
<span><span class="co">## to see the location, look at the "results_dir" field of the object</span></span>
<span><span class="fu"><a href="../reference/nm_getsetters.html">results_dir</a></span><span class="op">(</span><span class="va">dsm1</span><span class="op">$</span><span class="va">m</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## In this case we selec the first: dsm1$m[1]</span></span>
<span><span class="va">m1_f1</span> <span class="op">&lt;-</span> <span class="va">dsm1</span><span class="op">$</span><span class="va">m</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>   <span class="co">## select most significant BIC</span></span></code></pre></div>
<p>Do next forward step</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dsm2</span> <span class="op">&lt;-</span> <span class="va">m1_f1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/covariate_step_tibble.html">covariate_step_tibble</a></span><span class="op">(</span></span>
<span>  run_id <span class="op">=</span> <span class="st">"m1_f2"</span>,</span>
<span>  dtest <span class="op">=</span> <span class="va">dtest</span>,</span>
<span>  direction <span class="op">=</span> <span class="st">"forward"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>continue for as many steps as needed.</p>
</div>
<div class="section level2">
<h2 id="covariate-modelling-psn">Covariate modelling PsN<a class="anchor" aria-label="anchor" href="#covariate-modelling-psn"></a>
</h2>
<p>[placeholder]</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'be93a35b426aba9fa8e576efbb2011e7',
    indexName: 'NMproject',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
