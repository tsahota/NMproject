<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Topics • NMproject</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Advanced Topics">
<meta property="og:description" content="NMproject">
<meta property="og:image" content="https://tsahota.github.io/NMproject/logo.svg">
<meta name="google-site-verification" content="Asq9eKyn87Krpkza8Y-Y_XiS5V6eNXGAreGhOYcBKd0">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMproject</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_config.html">Configuration &amp; Setup Options</a>
    </li>
    <li>
      <a href="../articles/a02_analysis_directories.html">Analysis Directories</a>
    </li>
    <li>
      <a href="../articles/a03_demo.html">The Demo</a>
    </li>
    <li>
      <a href="../articles/a04_code_library.html">Code Library</a>
    </li>
    <li>
      <a href="../articles/a05_core_object.html">The basics of the NM object</a>
    </li>
    <li>
      <a href="../articles/a06_execution.html">NONMEM execution</a>
    </li>
    <li>
      <a href="../articles/a07_post_processing.html">Post-processing &amp; diagnostics</a>
    </li>
    <li>
      <a href="../articles/a08_covariate_modelling.html">Covariate Modelling</a>
    </li>
    <li>
      <a href="../articles/a09_advanced_topics.html">Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/a10_FAQ.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tsahota/NMproject/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a09_advanced_topics_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced Topics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tsahota/NMproject/blob/HEAD/vignettes/articles/a09_advanced_topics.Rmd" class="external-link"><code>vignettes/articles/a09_advanced_topics.Rmd</code></a></small>
      <div class="hidden name"><code>a09_advanced_topics.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="vectorisation">Vectorisation<a class="anchor" aria-label="anchor" href="#vectorisation"></a>
</h2>
<p>The basic nm object is fully vectorised. To see this compare the following two outputs</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m1</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ execute.Models/m1</span></span>
<span><span class="co">#&gt;   ..$ type        : chr "execute"</span></span>
<span><span class="co">#&gt;   ..$ run_id      : chr "m1"</span></span>
<span><span class="co">#&gt;   ..$ run_in      : chr "Models"</span></span>
<span><span class="co">#&gt;   ..$ executed    : logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ ctl_contents: chr <span style="color: #00BB00;">collapsed - view with ctl_contents()</span></span></span>
<span><span class="co">#&gt;   ..$ ctl_orig    : chr <span style="color: #00BB00;">collapsed - view with ctl_orig()</span></span></span>
<span><span class="co">#&gt;   ..$ data_path   : chr "DerivedData/data.csv"</span></span>
<span><span class="co">#&gt;   ..$ cmd         : chr "execute runm1.mod -dir=m1"</span></span>
<span><span class="co">#&gt;   ..$ cores       : int 1</span></span>
<span><span class="co">#&gt;   ..$ parafile    : chr "path/to/parafile.pnm"</span></span>
<span><span class="co">#&gt;   ..$ run_dir     : chr "m1"</span></span>
<span><span class="co">#&gt;   ..$ ctl_name    : chr "runm1.mod"</span></span>
<span><span class="co">#&gt;   ..$ results_dir : chr "Results"</span></span>
<span><span class="co">#&gt;   ..$ unique_id   : chr "execute.Models/m1"</span></span>
<span><span class="co">#&gt;   ..$ lst_path    : chr "m1/NM_run1/psn.lst"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "nm_execute" "nm_generic" "list"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "nm_list" "list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ execute.Models/m1</span></span>
<span><span class="co">#&gt;   ..$ type        : chr "execute"</span></span>
<span><span class="co">#&gt;   ..$ run_id      : chr "m1"</span></span>
<span><span class="co">#&gt;   ..$ run_in      : chr "Models"</span></span>
<span><span class="co">#&gt;   ..$ executed    : logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ ctl_contents: chr <span style="color: #00BB00;">collapsed - view with ctl_contents()</span></span></span>
<span><span class="co">#&gt;   ..$ ctl_orig    : chr <span style="color: #00BB00;">collapsed - view with ctl_orig()</span></span></span>
<span><span class="co">#&gt;   ..$ data_path   : chr "DerivedData/data.csv"</span></span>
<span><span class="co">#&gt;   ..$ cmd         : chr "execute runm1.mod -dir=m1"</span></span>
<span><span class="co">#&gt;   ..$ cores       : int 1</span></span>
<span><span class="co">#&gt;   ..$ parafile    : chr "path/to/parafile.pnm"</span></span>
<span><span class="co">#&gt;   ..$ run_dir     : chr "m1"</span></span>
<span><span class="co">#&gt;   ..$ ctl_name    : chr "runm1.mod"</span></span>
<span><span class="co">#&gt;   ..$ results_dir : chr "Results"</span></span>
<span><span class="co">#&gt;   ..$ unique_id   : chr "execute.Models/m1"</span></span>
<span><span class="co">#&gt;   ..$ lst_path    : chr "m1/NM_run1/psn.lst"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "nm_execute" "nm_generic" "list"</span></span>
<span><span class="co">#&gt;  $ execute.Models/m2</span></span>
<span><span class="co">#&gt;   ..$ type              : chr "execute"</span></span>
<span><span class="co">#&gt;   ..$ run_id            : chr "m2"</span></span>
<span><span class="co">#&gt;   ..$ run_in            : chr "Models"</span></span>
<span><span class="co">#&gt;   ..$ parent_run_id     : chr "m1"</span></span>
<span><span class="co">#&gt;   ..$ parent_run_in     : chr "Models"</span></span>
<span><span class="co">#&gt;   ..$ parent_ctl_name   : chr "runm1.mod"</span></span>
<span><span class="co">#&gt;   ..$ parent_results_dir: chr "Results"</span></span>
<span><span class="co">#&gt;   ..$ executed          : logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ ctl_contents      : chr <span style="color: #00BB00;">collapsed - view with ctl_contents()</span></span></span>
<span><span class="co">#&gt;   ..$ ctl_orig          : chr <span style="color: #00BB00;">collapsed - view with ctl_orig()</span></span></span>
<span><span class="co">#&gt;   ..$ data_path         : chr "DerivedData/data.csv"</span></span>
<span><span class="co">#&gt;   ..$ cmd               : chr "execute runm2.mod -dir=m2"</span></span>
<span><span class="co">#&gt;   ..$ cores             : int 1</span></span>
<span><span class="co">#&gt;   ..$ parafile          : chr "path/to/parafile.pnm"</span></span>
<span><span class="co">#&gt;   ..$ run_dir           : chr "m2"</span></span>
<span><span class="co">#&gt;   ..$ ctl_name          : chr "runm2.mod"</span></span>
<span><span class="co">#&gt;   ..$ results_dir       : chr "Results"</span></span>
<span><span class="co">#&gt;   ..$ unique_id         : chr "execute.Models/m2"</span></span>
<span><span class="co">#&gt;   ..$ lst_path          : chr "m2/NM_run1/psn.lst"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "nm_execute" "nm_generic" "list"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "nm_list" "list"</span></span></code></pre></div>
<p>Both are nm objects with length 1 and 2, respectively. We used the <code>c(m1, m2)</code> above when we wanted to use <code><a href="../reference/nm_render.html">nm_render()</a></code> on both runs. We didn’t need to write any loops or special code to handle this because nm objects and the functions that operate on them have been designed with parallelisation in mind. This is because in pharmacometrics we are often dealing with multiple models, perhaps moreso than other statistical modelling disciplines.</p>
<p>The vectorised nature of the nm object allows groups of runs to be created and run. To demonstrate, lets repeat the the previous initial perturbation exercise, but create 5 runs each with their own perturbed initial estimates.</p>
<p>The basic idea is to start with the parent object <code>m1</code> and then supplying a vector rather than a scalar to the <code><a href="../reference/child.html">child()</a></code> function. Since the <code>rep</code> column is length 5, this will make the nm_object length 5.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1rep</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## start with parent - m1 is length 1</span></span>
<span>  <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## now object is length = length(1:5) = 5</span></span>
<span>  <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">init</span>, mean <span class="op">=</span> <span class="va">init</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## vectorised operation</span></span>
<span>  <span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="st">"Models/m1rep"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## for tidiness, run these in their own sub-directory</span></span>
<span>  <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span> <span class="co">## run all 5 runs </span></span></code></pre></div>
<p>Notice how the functions <code><a href="../reference/init_theta.html">init_theta()</a></code>, <code><a href="../reference/nm_getsetters.html">run_in()</a></code> and <code><a href="../reference/run_nm.html">run_nm()</a></code> all worked on the nm object vector without needing loops.</p>
<p>To see all the $THETAS we can just run</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1rep</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`execute.Models/m1rep/1`</span></span>
<span><span class="co">#&gt;   1| $THETA</span></span>
<span><span class="co">#&gt;   2| 0.54245   ; KA ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   3| -2.9264   ; K ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   4| -0.24402   ; V ; L ; LOG</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/m1rep/2`</span></span>
<span><span class="co">#&gt;   1| $THETA</span></span>
<span><span class="co">#&gt;   2| 0.21905   ; KA ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   3| -2.4187   ; K ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   4| -0.93192   ; V ; L ; LOG</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/m1rep/3`</span></span>
<span><span class="co">#&gt;   1| $THETA</span></span>
<span><span class="co">#&gt;   2| -0.064319   ; KA ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   3| -2.5457   ; K ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   4| -0.82705   ; V ; L ; LOG</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/m1rep/4`</span></span>
<span><span class="co">#&gt;   1| $THETA</span></span>
<span><span class="co">#&gt;   2| 0.54117   ; KA ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   3| -2.4555   ; K ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   4| -1.0541   ; V ; L ; LOG</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/m1rep/5`</span></span>
<span><span class="co">#&gt;   1| $THETA</span></span>
<span><span class="co">#&gt;   2| 0.1068   ; KA ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   3| -2.2842   ; K ; h-1 ; LOG</span></span>
<span><span class="co">#&gt;   4| -0.54705   ; V ; L ; LOG</span></span></code></pre></div>
<p>We can also use standard <code>dplyr</code> to embed nm objects in data.frames. This is a useful way to organise groups of runs. E.g. the following would be an alternative way of running the previous lines which isn’t that useful here, but will be useful in the following section.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">d1rep</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    m <span class="op">=</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">rep</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">init</span>, mean <span class="op">=</span> <span class="va">init</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="st">"Models/m1rep"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">d1rep</span><span class="op">$</span><span class="va">m</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The parallel efficiency test in the <a href="https://tsahota.github.io/NMproject/articles/a6_execution.html#parallel-efficiency-test">NONMEM Execution Article</a> is also an example of vectorized nm object use.</p>
</div>
<div class="section level2">
<h2 id="automating-model-checking">Automating model checking<a class="anchor" aria-label="anchor" href="#automating-model-checking"></a>
</h2>
<p>Following on from the previous section we will now</p>
<p>Lets expand the earlier subroutine example to build a vector of runs that test multiple different <code>ADVAN</code>s and <code>TRANS</code> at the same time.</p>
<p>We’ll use a similar structure to the previous section using <code>.available_advans</code> to list all available ADVAN/TRANS options, <code>filter</code> to isolate specific ADVAN/TRANS options, and <code>mutate</code> and <code><a href="../reference/subroutine.html">subroutine()</a></code> to perform the control file manipulation function.</p>
<p>Then we’ll display all the <code>$PK</code> subroutines to view the changes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">.available_advans</span> <span class="co">## display available advans</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">#&gt;    advan trans   cmt oral  params                  label</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     1     1 FALSE K,V                     a1t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1     2     1 FALSE CL,V                    a1t2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2     1     1 TRUE  KA,K,V                  a2t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2     2     1 TRUE  KA,CL,V                 a2t2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     3     1     2 FALSE K,K12,K21,V             a3t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     3     3     2 FALSE CL,Q,V,VSS              a3t3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3     4     2 FALSE CL,Q,V1,V2              a3t4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     4     1     2 TRUE  KA,K,K23,K32,V2         a4t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4     3     2 TRUE  KA,CL,Q,V,VSS           a4t3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4     4     2 TRUE  KA,CL,Q,V2,V3           a4t4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a5t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     6     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a6t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     7     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a7t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     8     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a8t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     9     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a9t1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>    11     1     3 FALSE K,K12,K21,K13,K31,V     a11t1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>    11     4     3 FALSE CL,Q2,V1,V2,Q3,V3       a11t4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>    12     1     3 TRUE  KA,K,K23,K32,K24,K42,V2 a12t1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>    12     4     3 TRUE  KA,CL,Q3,V2,V3,Q4,V4    a12t4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>    13     1    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    KXY,VX                  a13t1</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">.available_advans</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## filter only for oral dosing advans</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">oral</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## mutate state create a column vector m of nm objects</span></span>
<span>  <span class="co">## first step is to create children runs from the parent object m1</span></span>
<span>  <span class="co">## this is done by supplying a vector of run_ids to the child() function</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>m <span class="op">=</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## start with parent m1 again</span></span>
<span>           <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">label</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## create multiple children using label column</span></span>
<span>           <span class="fu"><a href="../reference/subroutine.html">subroutine</a></span><span class="op">(</span>advan <span class="op">=</span> <span class="va">advan</span>, trans <span class="op">=</span> <span class="va">trans</span><span class="op">)</span> <span class="co">## set subroutine using advan and trans columns</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="co">## view the $PK blocks of each</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">m</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"PK"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`execute.Models/a2t1`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVK=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVK)</span></span>
<span><span class="co">#&gt;   9| K = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV)</span></span>
<span><span class="co">#&gt;  13| V = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| CL = K*V</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a2t2`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVCL=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVCL)</span></span>
<span><span class="co">#&gt;   9| CL = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV)</span></span>
<span><span class="co">#&gt;  13| V = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| ; CL = K*V</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a4t1`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVK=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVK)</span></span>
<span><span class="co">#&gt;   9| K = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV2=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV2)</span></span>
<span><span class="co">#&gt;  13| V2 = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| CL = K*V2</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V2</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt;  19| TVK23=EXP(THETA(4))</span></span>
<span><span class="co">#&gt;  20| MU_4=LOG(TVK23)</span></span>
<span><span class="co">#&gt;  21| K23 = EXP(MU_4+ETA(4))</span></span>
<span><span class="co">#&gt;  22| TVK32=EXP(THETA(5))</span></span>
<span><span class="co">#&gt;  23| MU_5=LOG(TVK32)</span></span>
<span><span class="co">#&gt;  24| K32 = EXP(MU_5+ETA(5))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a4t3`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVCL=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVCL)</span></span>
<span><span class="co">#&gt;   9| CL = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV)</span></span>
<span><span class="co">#&gt;  13| V = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| ; CL = K*V</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt;  19| TVQ=EXP(THETA(4))</span></span>
<span><span class="co">#&gt;  20| MU_4=LOG(TVQ)</span></span>
<span><span class="co">#&gt;  21| Q = EXP(MU_4+ETA(4))</span></span>
<span><span class="co">#&gt;  22| TVVSS=EXP(THETA(5))</span></span>
<span><span class="co">#&gt;  23| MU_5=LOG(TVVSS)</span></span>
<span><span class="co">#&gt;  24| VSS = EXP(MU_5+ETA(5))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a4t4`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVCL=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVCL)</span></span>
<span><span class="co">#&gt;   9| CL = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV2=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV2)</span></span>
<span><span class="co">#&gt;  13| V2 = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| ; CL = K*V</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V2</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt;  19| TVQ=EXP(THETA(4))</span></span>
<span><span class="co">#&gt;  20| MU_4=LOG(TVQ)</span></span>
<span><span class="co">#&gt;  21| Q = EXP(MU_4+ETA(4))</span></span>
<span><span class="co">#&gt;  22| TVV3=EXP(THETA(5))</span></span>
<span><span class="co">#&gt;  23| MU_5=LOG(TVV3)</span></span>
<span><span class="co">#&gt;  24| V3 = EXP(MU_5+ETA(5))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a12t1`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVK=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVK)</span></span>
<span><span class="co">#&gt;   9| K = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV2=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV2)</span></span>
<span><span class="co">#&gt;  13| V2 = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| CL = K*V2</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V2</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt;  19| TVK23=EXP(THETA(4))</span></span>
<span><span class="co">#&gt;  20| MU_4=LOG(TVK23)</span></span>
<span><span class="co">#&gt;  21| K23 = EXP(MU_4+ETA(4))</span></span>
<span><span class="co">#&gt;  22| TVK32=EXP(THETA(5))</span></span>
<span><span class="co">#&gt;  23| MU_5=LOG(TVK32)</span></span>
<span><span class="co">#&gt;  24| K32 = EXP(MU_5+ETA(5))</span></span>
<span><span class="co">#&gt;  25| TVK24=EXP(THETA(6))</span></span>
<span><span class="co">#&gt;  26| MU_6=LOG(TVK24)</span></span>
<span><span class="co">#&gt;  27| K24 = EXP(MU_6+ETA(6))</span></span>
<span><span class="co">#&gt;  28| TVK42=EXP(THETA(7))</span></span>
<span><span class="co">#&gt;  29| MU_7=LOG(TVK42)</span></span>
<span><span class="co">#&gt;  30| K42 = EXP(MU_7+ETA(7))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`execute.Models/a12t4`</span></span>
<span><span class="co">#&gt;   1| $PK</span></span>
<span><span class="co">#&gt;   2| </span></span>
<span><span class="co">#&gt;   3| TVKA=EXP(THETA(1))</span></span>
<span><span class="co">#&gt;   4| MU_1=LOG(TVKA)</span></span>
<span><span class="co">#&gt;   5| KA = EXP(MU_1+ETA(1))</span></span>
<span><span class="co">#&gt;   6| </span></span>
<span><span class="co">#&gt;   7| TVCL=EXP(THETA(2))</span></span>
<span><span class="co">#&gt;   8| MU_2=LOG(TVCL)</span></span>
<span><span class="co">#&gt;   9| CL = EXP(MU_2+ETA(2))</span></span>
<span><span class="co">#&gt;  10| </span></span>
<span><span class="co">#&gt;  11| TVV2=EXP(THETA(3))</span></span>
<span><span class="co">#&gt;  12| MU_3=LOG(TVV2)</span></span>
<span><span class="co">#&gt;  13| V2 = EXP(MU_3+ETA(3))</span></span>
<span><span class="co">#&gt;  14| </span></span>
<span><span class="co">#&gt;  15| ; CL = K*V</span></span>
<span><span class="co">#&gt;  16| </span></span>
<span><span class="co">#&gt;  17| S2 = V2</span></span>
<span><span class="co">#&gt;  18| </span></span>
<span><span class="co">#&gt;  19| TVQ3=EXP(THETA(4))</span></span>
<span><span class="co">#&gt;  20| MU_4=LOG(TVQ3)</span></span>
<span><span class="co">#&gt;  21| Q3 = EXP(MU_4+ETA(4))</span></span>
<span><span class="co">#&gt;  22| TVV3=EXP(THETA(5))</span></span>
<span><span class="co">#&gt;  23| MU_5=LOG(TVV3)</span></span>
<span><span class="co">#&gt;  24| V3 = EXP(MU_5+ETA(5))</span></span>
<span><span class="co">#&gt;  25| TVQ4=EXP(THETA(6))</span></span>
<span><span class="co">#&gt;  26| MU_6=LOG(TVQ4)</span></span>
<span><span class="co">#&gt;  27| Q4 = EXP(MU_6+ETA(6))</span></span>
<span><span class="co">#&gt;  28| TVV4=EXP(THETA(7))</span></span>
<span><span class="co">#&gt;  29| MU_7=LOG(TVV4)</span></span>
<span><span class="co">#&gt;  30| V4 = EXP(MU_7+ETA(7))</span></span></code></pre></div>
<p>Let’s run these, summarise the results, and generate goodness of fit diagnostics for the ones that gave somewhat reasonable outputs</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## run them all and wait for them to finish</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">m</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/wait_finish.html">wait_finish</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summarise all runs in a table</span></span>
<span><span class="fu"><a href="../reference/nm_summary.html">summary_wide</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot goodness of fits for all runs with ofv &lt; 120</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">m</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="../reference/ofv.html">ofv</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co">## subsetting is a powerful way of isolating functions to particular model objects</span></span>
<span>  <span class="fu"><a href="../reference/nm_render.html">nm_render</a></span><span class="op">(</span><span class="st">"Scripts/basic_gof.Rmd"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-re-estimation">Simulation re-estimation<a class="anchor" aria-label="anchor" href="#simulation-re-estimation"></a>
</h2>
<p>There will soon a be a simple wrapper for the code below, as with the bootstrap and step wise covariate functionality above, but for now the code below is a good example of how the flexibility of the vectorised object can be used to create complex workflows whilst still providing granular control of runs.</p>
<p>It’s good advice to start with 1 or 2 replicates and scale up only when you’ve confirmed your code is working (here we’re just using 3 for demo purposes). You will not waste time because <code><a href="../reference/run_nm.html">run_nm()</a></code> will skip over runs that have already completed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">3</span>  <span class="co">## start small, scale up later</span></span>
<span></span>
<span><span class="va">dsr</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>sim <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    msim <span class="op">=</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>              <span class="co">## start with single parent run, m1, an nm object of length 1</span></span>
<span>      <span class="fu"><a href="../reference/update_parameters.html">update_parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co">## update inits to finals, here nm object is still length 1</span></span>
<span>      <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">sim</span>, parent <span class="op">=</span> <span class="va">m1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co">## at this point it becomes length n_sims</span></span>
<span>      <span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="st">"Models/m1_simest"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## this applies the run_in modification to all n_sims runs</span></span>
<span>      <span class="fu"><a href="../reference/convert_to_simulation.html">convert_to_simulation</a></span><span class="op">(</span>subpr <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="va">sim</span><span class="op">)</span> <span class="co">## converts all to simulation</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## run, wait, read results and then write to run_dir paths of simulations</span></span>
<span><span class="va">dsr</span><span class="op">$</span><span class="va">msim</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/wait_finish.html">wait_finish</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/output_table.html">output_table</a></span><span class="op">(</span>only_append <span class="op">=</span> <span class="st">"DV_OUT"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/write_derived_data.html">write_derived_data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="../reference/run_dir_path.html">run_dir_path</a></span><span class="op">(</span><span class="va">dsr</span><span class="op">$</span><span class="va">msim</span><span class="op">)</span>, <span class="st">"simdata.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Now create mest column</span></span>
<span><span class="va">dsr</span> <span class="op">&lt;-</span> <span class="va">dsr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    mest <span class="op">=</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co">## estimations derived from m1</span></span>
<span>      <span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="st">"Models/m1_simest/est"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>   <span class="co">## run in a new subdirectory</span></span>
<span>      <span class="fu"><a href="../reference/data_path.html">data_path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="../reference/run_dir_path.html">run_dir_path</a></span><span class="op">(</span><span class="va">msim</span><span class="op">)</span>, <span class="st">"simdata.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>    <span class="co">## set new data_paths</span></span>
<span>      <span class="co">## refill $INPUT. Rename DV to be DV_OUT column. Run nm_diff() command below to see</span></span>
<span>      <span class="co">## what has changed</span></span>
<span>      <span class="fu"><a href="../reference/fill_input.html">fill_input</a></span><span class="op">(</span>rename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"DV_OBS"</span> <span class="op">=</span> <span class="st">"DV"</span>, <span class="st">"DV"</span> <span class="op">=</span> <span class="st">"DV_OUT"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># nm_diff(dsr$mest[1])</span></span>
<span></span>
<span><span class="va">dsr</span><span class="op">$</span><span class="va">mest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/wait_finish.html">wait_finish</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nm_summary.html">summary_wide</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'be93a35b426aba9fa8e576efbb2011e7',
    indexName: 'NMproject',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
