<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The basics of the NM object • NMproject</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="The basics of the NM object">
<meta property="og:description" content="NMproject">
<meta property="og:image" content="https://tsahota.github.io/NMproject/logo.svg">
<meta name="google-site-verification" content="Asq9eKyn87Krpkza8Y-Y_XiS5V6eNXGAreGhOYcBKd0">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMproject</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_config.html">Configuration &amp; Setup Options</a>
    </li>
    <li>
      <a href="../articles/a02_analysis_directories.html">Analysis Directories</a>
    </li>
    <li>
      <a href="../articles/a03_demo.html">The Demo</a>
    </li>
    <li>
      <a href="../articles/a04_code_library.html">Code Library</a>
    </li>
    <li>
      <a href="../articles/a05_core_object.html">The basics of the NM object</a>
    </li>
    <li>
      <a href="../articles/a06_execution.html">NONMEM execution</a>
    </li>
    <li>
      <a href="../articles/a07_post_processing.html">Post-processing &amp; diagnostics</a>
    </li>
    <li>
      <a href="../articles/a08_covariate_modelling.html">Covariate Modelling</a>
    </li>
    <li>
      <a href="../articles/a09_advanced_topics.html">Advanced Topics</a>
    </li>
    <li>
      <a href="../articles/a10_FAQ.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tsahota/NMproject/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a05_core_object_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The basics of the NM object</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tsahota/NMproject/blob/HEAD/vignettes/articles/a05_core_object.Rmd" class="external-link"><code>vignettes/articles/a05_core_object.Rmd</code></a></small>
      <div class="hidden name"><code>a05_core_object.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="basics">Basics<a class="anchor" aria-label="anchor" href="#basics"></a>
</h2>
<p>The core nm object is created via the <code><a href="../reference/new_nm.html">new_nm()</a></code>. Subsequent child objects are created via the <code><a href="../reference/child.html">child()</a></code> function. All interactions with NONMEM occur through the this object. It contains metadata about the NONMEM run and contain the contents of what will written as the control file (also called model file).</p>
<p>NONMEM control files are only written to the <code>Models</code> sub-directory just before running NONMEM via the <code><a href="../reference/run_nm.html">run_nm()</a></code> command</p>
<p>Let’s create our first NONMEM object with <code><a href="../reference/new_nm.html">new_nm()</a></code>. This will be a parent run to all other runs and thus requires more set up than other runs. Subsequent child objects created with <code><a href="../reference/child.html">child()</a></code> will inherits characteristics of the parent.</p>
<p>Three arguments are required to create the parent, a run identifier, <code>run_id</code>, a control file it’s based on, <code>based_on</code>, and a (relative) dataset path <code>data_path</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_nm.html">new_nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
             based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
             data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span><span class="op">)</span>

<span class="va">m1</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ execute.Models/m1</span>
<span class="co">#&gt;   ..$ type        : chr "execute"</span>
<span class="co">#&gt;   ..$ run_id      : chr "m1"</span>
<span class="co">#&gt;   ..$ run_in      : chr "Models"</span>
<span class="co">#&gt;   ..$ executed    : logi FALSE</span>
<span class="co">#&gt;   ..$ ctl_contents: chr <span style="color: #00BB00;">collapsed - view with ctl_contents()</span></span>
<span class="co">#&gt;   ..$ ctl_orig    : chr <span style="color: #00BB00;">collapsed - view with ctl_orig()</span></span>
<span class="co">#&gt;   ..$ data_path   : chr "DerivedData/data.csv"</span>
<span class="co">#&gt;   ..$ cmd         : chr "execute runm1.mod -dir=m1"</span>
<span class="co">#&gt;   ..$ cores       : int 1</span>
<span class="co">#&gt;   ..$ parafile    : chr "path/to/parafile.pnm"</span>
<span class="co">#&gt;   ..$ run_dir     : chr "m1"</span>
<span class="co">#&gt;   ..$ ctl_name    : chr "runm1.mod"</span>
<span class="co">#&gt;   ..$ results_dir : chr "Results"</span>
<span class="co">#&gt;   ..$ unique_id   : chr "execute.Models/m1"</span>
<span class="co">#&gt;   ..$ lst_path    : chr "m1/NM_run1/psn.lst"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "nm_execute" "nm_generic" "list"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "nm_list" "list"</span></code></pre></div>
<p>Display the object by typing <code>m1</code> in the console. Notice that the <code>run_in</code> field is point to <code>Models</code>. This can be changed by piping the function of the same name e.g. </p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_nm.html">new_nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
             based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
             data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="st">"NONMEM/base_model"</span><span class="op">)</span></code></pre></div>
<p>will run all models in a subdirectory of a subdirectory <code>NONMEM/base_model/</code> instead (the $DATA (relative) path to the dataset will be automatically be updated to reflect the new location of the control file). Any field can by modified using a similar heuristic.</p>
<p>Piping is encouraged because it enables you to read the sequence of events in the order that they occur. Here we just have a single pipe, but you’ll see that we will frequently pipe longer chains of commands together. Each step is applying a transformation to the core nm object. The chain can be partially run in the console to see what each transformation is doing. The rest of this document is full of pipes so if you are unfamiliar with pipes, please consult the <code>magrittr</code> documentation.</p>
<p>To extract a field (rather than set a field) use the same function without additional arguments:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/nm_getsetters.html">run_in</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; [1] "NONMEM/base_model"</span></code></pre></div>
<p>For now though, we’ll remove the last piped command and stay with the default <code>run_in</code> location.</p>
<p><em>NOTE:</em> the field <code>ctl_name</code> refers to the name of the control that will be created. This will only be created when it the model is run with the <code><a href="../reference/run_nm.html">run_nm()</a></code> function (described later). For now, the control file contents reside inside the object. To view these you can use “show model/ctl file” RStudio ‘Addin’ , or <code>text(m1)</code>.</p>
<p>A few automatic edits from the staged control file and a compact representation of these changes can be shown by highlighting the above code and selecting the “nm_diff” RStudio ‘Addin’ which show what has been changed.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mYUaKrj0-YE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Learning how to read to diffs will be an important skill in NMproject you will pick up over time. Notice how the <code>$DATA</code> has been updated to refer to the new location.</p>
<p>The default <code><a href="../reference/nm_getsetters.html">cmd()</a></code> field of the object is <code>execute {ctl_name} -dir={run_dir}</code>. The braces are referred to as <code>glue</code> fields using the <code>glue</code> package. These refer to field names of the object that will be substituted in. For completeness on the next step we will explicitly set this to ensure our model development is easy to read.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_nm.html">new_nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
             based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
             data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/nm_getsetters.html">cmd</a></span><span class="op">(</span><span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span></code></pre></div>
<p>The final steps to gets the NONMEM model ready is to fill in the remaining blanks in the template. They are the <code>$INPUT</code> and <code>$THETA</code>, <code>$OMEGA</code>. For this we will use the <code><a href="../reference/fill_input.html">fill_input()</a></code> and <code><a href="../reference/init_theta.html">init_theta()</a></code> and <code><a href="../reference/init_theta.html">init_omega()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_nm.html">new_nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
             based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
             data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/nm_getsetters.html">cmd</a></span><span class="op">(</span><span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/fill_input.html">fill_input</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/init_theta.html">init_sigma</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="executing-nonmem">Executing NONMEM<a class="anchor" aria-label="anchor" href="#executing-nonmem"></a>
</h2>
<p>Thus far, we have not executed NONMEM nor saved the control file to the file system. To execute, we simply pipe into the <code><a href="../reference/run_nm.html">run_nm()</a></code> function which will often form the last step of the chain and then run the command. For more information about executing NONMEM, performing NMTRAN checks and monitoring convergence see the <a href="https://tsahota.github.io/NMproject/articles/a6_execution.html">Execution article</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_nm.html">new_nm</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m1"</span>,
             based_on <span class="op">=</span> <span class="st">"staging/Models/ADVAN2.mod"</span>,
             data_path <span class="op">=</span> <span class="st">"DerivedData/data.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/nm_getsetters.html">cmd</a></span><span class="op">(</span><span class="st">"execute {ctl_name} -dir={run_dir}"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/fill_input.html">fill_input</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/init_theta.html">init_sigma</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="manual-edits">Manual edits<a class="anchor" aria-label="anchor" href="#manual-edits"></a>
</h2>
<p>Often there will not be the functions to do the control file manipulation you want. Although it is preferable to stick to automatic control file manipulation functions, you can do fully tracked manual edits via the “manual edit” RStudio ‘Addins’ menu. Again, just highlight the code, click the ‘Addin’ and follow the instructions:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HyCHeAAiwy4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div class="section level2">
<h2 id="automatic-edits">Automatic edits<a class="anchor" aria-label="anchor" href="#automatic-edits"></a>
</h2>
<p>NMproject contains several functions for automatic control file edits. We have already seen <code><a href="../reference/fill_input.html">fill_input()</a></code> and <code><a href="../reference/init_theta.html">init_theta()</a></code> etc. There are higher order functions which make multiple changes to your control stream, one of which is the <code><a href="../reference/subroutine.html">subroutine()</a></code>. If we already have a parent run <code>m1</code> using <code>ADVAN2 TRANS1</code>, we can create a <code><a href="../reference/child.html">child()</a></code> run that uses <code>TRANS2</code> using:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/subroutine.html">subroutine</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>View exactly what’s been changed by highlighting the above code in RStudio and clicking the "nm_diff RStudio ‘Addin’ to see what’s been changed before running. Here, changes will be in the <code>$SUB</code>, <code>$PK</code> and <code>$THETA</code>.</p>
<p>To add a covariate using PsN coding conventions use <code><a href="../reference/add_remove_covs.html">add_cov()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m2WT</span> <span class="op">&lt;-</span> <span class="va">m2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/child.html">child</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="st">"m2WT"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_remove_covs.html">add_cov</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"CL"</span>, cov <span class="op">=</span> <span class="st">"WT"</span>, state <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_nm.html">run_nm</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initial-estimates">Initial estimates<a class="anchor" aria-label="anchor" href="#initial-estimates"></a>
</h2>
<p>We saw a little at how the functions <code>init_theta</code>, <code>init_omega</code> and <code>init_sigma</code> can be used to set initial estimates earlier. The functions actually allow manipulation of initial estimates, parameter bounds, names, units, etc.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## display R representaton of $THETA</span>
<span class="va">it</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">it</span>
<span class="co">#&gt;   name parameter lower init upper theta   FIX unit trans line pos orig_line</span>
<span class="co">#&gt; 2   KA    THETA1    NA  0.5    NA     1 FALSE  h-1   LOG    2   1         2</span>
<span class="co">#&gt; 3    K    THETA2    NA -2.5    NA     2 FALSE  h-1   LOG    3   1         3</span>
<span class="co">#&gt; 4    V    THETA3    NA -0.5    NA     3 FALSE    L   LOG    4   1         4</span></code></pre></div>
<p>Note that the use of <code><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">dplyr::first()</a></code> is because <code>init_theta</code> returns a list of a <code>data.frame</code> and since we want to manipulate <code>io</code>, it’s easier if it’s a <code>data.frame</code> or <code>tibble</code> as then we can use R extensive <code>data.frame</code> manipulation functions. We use the same init_theta with the modified <code>tibble</code> to update the nm object like so:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## this is the slower method - only for illustration purposes</span>
<span class="va">it</span><span class="op">$</span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span> 
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $THETA</span>
<span class="co">#&gt;   2| 0   ; KA ; h-1 ; LOG</span>
<span class="co">#&gt;   3| 1   ; K ; h-1 ; LOG</span>
<span class="co">#&gt;   4| 2   ; V ; L ; LOG</span></code></pre></div>
<p>This is quite inconvenient though as it requires 3 lines of R code. Knowing the columns of the ‘tibble’ though, we can manipulate values directly like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Reset in one line to what we set it to earlier</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> 
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $THETA</span>
<span class="co">#&gt;   2| -2   ; KA ; h-1 ; LOG</span>
<span class="co">#&gt;   3| 0.5   ; K ; h-1 ; LOG</span>
<span class="co">#&gt;   4| 1   ; V ; L ; LOG</span>

<span class="co">## This however requires knowing the order of parameters</span>
<span class="co">## here we supply a named vector in a different order</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, V <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $THETA</span>
<span class="co">#&gt;   2| -2   ; KA ; h-1 ; LOG</span>
<span class="co">#&gt;   3| 0.5   ; K ; h-1 ; LOG</span>
<span class="co">#&gt;   4| 1   ; V ; L ; LOG</span>

<span class="co">## can also manipulate other aspects (like the FIX column) similarly</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, V <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                        FIX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $THETA</span>
<span class="co">#&gt;   2| -2 FIX   ; KA ; h-1 ; LOG</span>
<span class="co">#&gt;   3| 0.5   ; K ; h-1 ; LOG</span>
<span class="co">#&gt;   4| 1   ; V ; L ; LOG</span></code></pre></div>
<p>It works similarly for $OMEGA and $SIGMA with init_omega and init_sigma, respectively.</p>
</div>
<div class="section level2">
<h2 id="perturbing-initial-parameters">Perturbing initial parameters<a class="anchor" aria-label="anchor" href="#perturbing-initial-parameters"></a>
</h2>
<p>To modify initial estimates, we’ll use the <code>mutate</code> like behaviour of <code>init_*</code> functions. We will modify the <code>init</code> by referencing itself. We’ll modified all our fixed effects (log transformed) by 30%</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_theta</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">init</span>, mean <span class="op">=</span> <span class="va">init</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"THETA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $THETA</span>
<span class="co">#&gt;   2| -1.8578 FIX   ; KA ; h-1 ; LOG</span>
<span class="co">#&gt;   3| 0.58016   ; K ; h-1 ; LOG</span>
<span class="co">#&gt;   4| 1.0421   ; V ; L ; LOG</span>

<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_omega</a></span><span class="op">(</span>init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">init</span>, min <span class="op">=</span> <span class="va">init</span><span class="op">/</span><span class="fl">2</span>, max <span class="op">=</span> <span class="va">init</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"OMEGA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $OMEGA</span>
<span class="co">#&gt;   2| 0.11699   ;  IIV_KA ; LOG</span>
<span class="co">#&gt;   3| 0.18125   ;  IIV_K ; LOG</span>
<span class="co">#&gt;   4| 0.097217   ;  IIV_V ; LOG</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-omegasigma-blocks">Working with $OMEGA/$SIGMA BLOCKS<a class="anchor" aria-label="anchor" href="#working-with-omegasigma-blocks"></a>
</h2>
<p>We can include and remove $OMEGA blocks with the functions <code>block</code> and <code>unblock</code> (to create $OMEGA BLOCKS for correlated random effects).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">io</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_omega</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">## note we dont need dplyr::first as block()/unblock() also work on lists of tibbles.</span>
<span class="va">io</span> 
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;     name omega1 omega2 lower     init upper block mblock   FIX unit trans line</span>
<span class="co">#&gt; 1   &lt;NA&gt;     NA     NA    NA       NA    NA     1     NA FALSE &lt;NA&gt;  &lt;NA&gt;    1</span>
<span class="co">#&gt; 2 IIV_KA      1      1    NA 0.116990    NA     1      1 FALSE &lt;NA&gt;   LOG    2</span>
<span class="co">#&gt; 3  IIV_K      2      2    NA 0.181250    NA     2      1 FALSE &lt;NA&gt;   LOG    3</span>
<span class="co">#&gt; 4  IIV_V      3      3    NA 0.097217    NA     3      1 FALSE &lt;NA&gt;   LOG    4</span>
<span class="co">#&gt;   pos orig_line orig_pos</span>
<span class="co">#&gt; 1   1         1        1</span>
<span class="co">#&gt; 2   1         2        1</span>
<span class="co">#&gt; 3   1         3        1</span>
<span class="co">#&gt; 4   1         4        1</span>

<span class="va">io</span> <span class="op">&lt;-</span> <span class="va">io</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/block-omega-sigma.html">block</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>  <span class="co">## make block out ETA 2 and 3</span>

<span class="co">## put modified io wit</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_omega</a></span><span class="op">(</span><span class="va">io</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"OMEGA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $OMEGA</span>
<span class="co">#&gt;   2| 0.11699   ;   IIV_KA ; LOG</span>
<span class="co">#&gt;   3| $OMEGA BLOCK (2)</span>
<span class="co">#&gt;   4| 0.18125   ;   IIV_K ; LOG</span>
<span class="co">#&gt;   5| 0.01 0.097217   ;   IIV_V ; LOG</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## for demo purposes we'll reverse the process with unblock()</span>
<span class="va">io</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_omega</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">io</span> <span class="op">&lt;-</span> <span class="va">io</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/block-omega-sigma.html">unblock</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/init_theta.html">init_omega</a></span><span class="op">(</span><span class="va">io</span><span class="op">)</span>
<span class="va">m1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dollar.html">dollar</a></span><span class="op">(</span><span class="st">"OMEGA"</span><span class="op">)</span>
<span class="co">#&gt; $`execute.Models/m1`</span>
<span class="co">#&gt;   1| $OMEGA</span>
<span class="co">#&gt;   2| 0.11699   ;    IIV_KA ; LOG</span>
<span class="co">#&gt;   3| 0.18125   ;    IIV_K ; LOG</span>
<span class="co">#&gt;   4| 0.097217   ;    IIV_V ; LOG</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'be93a35b426aba9fa8e576efbb2011e7',
    indexName: 'NMproject',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
