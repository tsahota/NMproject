<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Prepare forward covariate step — covariate_step_tibble • NMproject</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Prepare forward covariate step — covariate_step_tibble" />
<meta property="og:description" content="
Takes a base nm object and a set of relationships to test (from
test_relations()) and prepares a tibble of NONMEM runs.
The goal of NMproject's covariate modelling functions is to provide a
stepwise covariate method with manual decision making.  This important to
ensure that the full model selection/evaluation criteria (should be defined
in statistical analysis plans) can be applied at every step rather than just
log likelihood ratio testing, where the most significant model may be
unstable, may worsen model predictions or may only be slightly more
significant than a more physiologically plausible covariate relationship.
The functions test_relations(), covariate_step_tibble(),
bind_covariate_results() together comprise NMproject stepwise covariate
method with manual decision.  The goal is to be part way between PsN's SCM
and completely manual process at each forward and backward elimination step.
The syntax of how covariates are included is the same as PsN's SCM routine -
See PsN documentation
for more information." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMproject</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/articles/NMproject.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tsahota/NMproject/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prepare forward covariate step</h1>
    <small class="dont-index">Source: <a href='https://github.com/tsahota/NMproject/blob/master/R/stepwise-covariate.R'><code>R/stepwise-covariate.R</code></a></small>
    <div class="hidden name"><code>covariate_step_tibble.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href='https://lifecycle.r-lib.org/articles/stages.html#stable'><img src='figures/lifecycle-stable.svg' alt='[Stable]' /></a></p>
<p>Takes a base nm object and a set of relationships to test (from
<code><a href='test_relations.html'>test_relations()</a></code>) and prepares a <code>tibble</code> of NONMEM runs.</p>
<p>The goal of NMproject's covariate modelling functions is to provide a
stepwise covariate method <em>with manual decision</em> making.  This important to
ensure that the full model selection/evaluation criteria (should be defined
in statistical analysis plans) can be applied at every step rather than just
log likelihood ratio testing, where the most significant model may be
unstable, may worsen model predictions or may only be slightly more
significant than a more physiologically plausible covariate relationship.</p>
<p>The functions <code><a href='test_relations.html'>test_relations()</a></code>, <code>covariate_step_tibble()</code>,
<code><a href='bind_covariate_results.html'>bind_covariate_results()</a></code> together comprise NMproject stepwise covariate
method with manual decision.  The goal is to be part way between PsN's SCM
and completely manual process at each forward and backward elimination step.
The syntax of how covariates are included is the same as PsN's SCM routine -
See <a href='https://uupharmacometrics.github.io/PsN/docs.html'>PsN documentation</a>
for more information.</p>
    </div>

    <pre class="usage"><span class='fu'>covariate_step_tibble</span><span class='op'>(</span>
  <span class='va'>base</span>,
  <span class='va'>run_id</span>,
  run_in <span class='op'>=</span> <span class='fu'><a href='nm_dir.html'>nm_dir</a></span><span class='op'>(</span><span class='st'>"models"</span><span class='op'>)</span>,
  <span class='va'>dtest</span>,
  direction <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"forward"</span>, <span class='st'>"backward"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>base</th>
      <td><p>An nm object.</p></td>
    </tr>
    <tr>
      <th>run_id</th>
      <td><p>Base run_id to construct run_ids of covariate runs.</p></td>
    </tr>
    <tr>
      <th>run_in</th>
      <td><p>Character.  See <code><a href='nm_getsetters.html'>run_in()</a></code>.</p></td>
    </tr>
    <tr>
      <th>dtest</th>
      <td><p><code><a href='https://tibble.tidyverse.org/reference/tibble.html'>dplyr::tibble</a></code> with testing relations (from
<code><a href='test_relations.html'>test_relations()</a></code>).</p></td>
    </tr>
    <tr>
      <th>direction</th>
      <td><p>Character. <code>"forward"</code> (default) or <code>"backward"</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='add_remove_covs.html'>add_cov()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Will return <code>dtest</code> a <code><a href='https://tibble.tidyverse.org/reference/tibble.html'>dplyr::tibble</a></code> with appended columns.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='test_relations.html'>test_relations()</a></code>, <code><a href='bind_covariate_results.html'>bind_covariate_results()</a></code>, <code><a href='add_remove_covs.html'>add_cov()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>dtest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='test_relations.html'>test_relations</a></span><span class='op'>(</span>param <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KA"</span>, <span class='st'>"K"</span>, <span class='st'>"V"</span><span class='op'>)</span>,
                        cov <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"LIN1"</span>, <span class='st'>"LIN2"</span>, <span class='st'>"LIN3"</span>, <span class='st'>"RND1"</span>, <span class='st'>"RND2"</span>, <span class='st'>"RND3"</span><span class='op'>)</span>,
                        state <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"linear"</span>, <span class='st'>"power"</span><span class='op'>)</span>,
                        continuous <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
         <span class='fu'><a href='test_relations.html'>test_relations</a></span><span class='op'>(</span>param <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KA"</span>, <span class='st'>"K"</span>, <span class='st'>"V"</span><span class='op'>)</span>,
                        cov <span class='op'>=</span> <span class='st'>"BN1"</span>,
                        state <span class='op'>=</span> <span class='st'>"linear"</span>,
                        continuous <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
                        
<span class='co'># create example object m1 from package demo files</span>
<span class='va'>exdir</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"examples"</span>, <span class='st'>"theopp"</span>, package <span class='op'>=</span> <span class='st'>"NMproject"</span><span class='op'>)</span>
<span class='va'>m1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='new_nm.html'>new_nm</a></span><span class='op'>(</span>run_id <span class='op'>=</span> <span class='st'>"m1"</span>, 
             based_on <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>exdir</span>, <span class='st'>"Models"</span>, <span class='st'>"ADVAN2.mod"</span><span class='op'>)</span>,
             data_path <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>exdir</span>, <span class='st'>"SourceData"</span>, <span class='st'>"THEOPP.csv"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>temp_data_file</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempfile</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>".csv"</span><span class='op'>)</span>

<span class='co'>## dataset has missing WTs so create a new one and assign this to the run</span>
<span class='fu'><a href='input_data.html'>input_data</a></span><span class='op'>(</span><span class='va'>m1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ID</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>WT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>WT</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='write_derived_data.html'>write_derived_data</a></span><span class='op'>(</span><span class='va'>temp_data_file</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>written: </span></div><div class='output co'>#&gt; <span class='message'>/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpWqPi65/file10a04c3c1353.RDS</span></div><div class='output co'>#&gt; <span class='message'>/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpWqPi65/file10a04c3c1353.csv</span></div><div class='input'>  
<span class='va'>m1</span> <span class='op'>&lt;-</span> <span class='va'>m1</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='data_path.html'>data_path</a></span><span class='op'>(</span><span class='va'>temp_data_file</span><span class='op'>)</span>
 
<span class='va'>dtest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='test_relations.html'>test_relations</a></span><span class='op'>(</span>param <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"K"</span>, <span class='st'>"V"</span><span class='op'>)</span>,
                        cov <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"WT"</span><span class='op'>)</span>,
                        state <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"linear"</span>, <span class='st'>"power"</span><span class='op'>)</span>,
                        continuous <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'>## requires NONMEM to be installed</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>## create tibble of covariate step with model objects as column m</span>
<span class='va'>dsm1</span> <span class='op'>&lt;-</span> <span class='va'>m1</span> <span class='op'>%&gt;%</span> <span class='fu'>covariate_step_tibble</span><span class='op'>(</span>run_id <span class='op'>=</span> <span class='st'>"m1_f1"</span>,
                                     dtest <span class='op'>=</span> <span class='va'>dtest</span>,
                                     direction <span class='op'>=</span> <span class='st'>"forward"</span><span class='op'>)</span>

<span class='co'>## run all models greedily</span>
<span class='va'>dsm1</span><span class='op'>$</span><span class='va'>m</span> <span class='op'>&lt;-</span> <span class='va'>dsm1</span><span class='op'>$</span><span class='va'>m</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='run_nm.html'>run_nm</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'>## extract results and put into tibble</span>
<span class='va'>dsm1</span> <span class='op'>&lt;-</span> <span class='va'>dsm1</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='bind_covariate_results.html'>bind_covariate_results</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'>## sort by BIC (for example) and view</span>
<span class='va'>dsm1</span> <span class='op'>&lt;-</span> <span class='va'>dsm1</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>BIC</span><span class='op'>)</span>
<span class='va'>dsm1</span>

<span class='co'>## check condition number, covariance,...</span>
<span class='co'>## run any diagnostics here</span>

<span class='co'>## when happy with selection, select run for subsequent step</span>

<span class='va'>m1_f1</span> <span class='op'>&lt;-</span> <span class='va'>dsm1</span><span class='op'>$</span><span class='va'>m</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='co'>## select most signifcant BIC</span>
<span class='co'># alternative select by relationship</span>
<span class='va'>m1_f1</span> <span class='op'>&lt;-</span> <span class='va'>dsm1</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>param <span class='op'>=</span> <span class='st'>"CL"</span>, cov <span class='op'>=</span> <span class='st'>"BWT"</span>, state <span class='op'>=</span> <span class='st'>"power"</span><span class='op'>)</span> <span class='op'>%$%</span>
  <span class='va'>m</span>

<span class='co'>## do next forward step</span>

<span class='va'>dsm2</span> <span class='op'>&lt;-</span> <span class='va'>m1_f1</span> <span class='op'>%&gt;%</span> <span class='fu'>covariate_step_tibble</span><span class='op'>(</span>run_id <span class='op'>=</span> <span class='st'>"m1_f2"</span>,
                                        dtest <span class='op'>=</span> <span class='va'>dtest</span>,
                                        direction <span class='op'>=</span> <span class='st'>"forward"</span><span class='op'>)</span>

<span class='co'>## continue ...</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tarj Sahota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'be93a35b426aba9fa8e576efbb2011e7',
    indexName: 'NMproject',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


